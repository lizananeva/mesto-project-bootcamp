(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-12",headers:{authorization:"16ed90c9-12a0-4919-8ff0-430d22a9bbfe","Content-Type":"application/json"}},e=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},n=document.querySelectorAll(".popup"),o=function(t){"Escape"===t.key&&n.forEach((function(t){return a(t)}))},r=function(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&a(t.target.closest(".popup"))},c=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",o)},a=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",o)};n.forEach((function(t){t.addEventListener("mousedown",r)}));var u=document.querySelector("#card").content.querySelector(".photo-grid__item"),i=document.querySelector(".photo-grid__list"),s=document.querySelector(".popup_type_photo"),l=s.querySelector(".popup__image"),d=s.querySelector(".popup__caption"),f=document.querySelector(".popup_type_delete-card"),m=document.forms.delete,p=function(n){var o=u.cloneNode(!0),r=o.querySelector(".photo__image"),i=o.querySelector(".photo__caption"),p=o.querySelector(".photo__like-button"),h=o.querySelector(".photo__like-count"),v=o.querySelector(".photo__delete-button");return r.src=n.link,r.alt=n.name,i.textContent=n.name,h.textContent=n.likes.length,n.likes.some((function(t){return t._id===localStorage.getItem("id")}))&&p.classList.add("photo__like-button_active"),n.owner._id!==localStorage.getItem("id")&&v.remove(),r.addEventListener("click",(function(t){c(s),l.src=r.src,l.alt=r.alt,d.textContent=r.alt})),p.addEventListener("click",(function(o){var r;o.target.classList.contains("photo__like-button_active")?(r=n._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:t.headers}).then((function(t){return e(t)}))).then((function(t){o.target.classList.remove("photo__like-button_active"),h.textContent=t.likes.length})).catch((function(t){return console.log(t.status)})):function(n){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:t.headers}).then((function(t){return e(t)}))}(n._id).then((function(t){o.target.classList.add("photo__like-button_active"),h.textContent=t.likes.length})).catch((function(t){return console.log(t.status)}))})),v.addEventListener("click",(function(){c(f),m.addEventListener("submit",(function(r){var c;r.preventDefault(),(c=n._id,fetch("".concat(t.baseUrl,"/cards/").concat(c),{method:"DELETE",headers:t.headers}).then((function(t){return e(t)}))).then((function(){o.remove(),a(f)})).catch((function(t){return console.log(t.status)}))}))})),o},h=function(t){i.prepend(t)},v=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove("".concat(n.errorClass,"_active")),o.textContent=""},_=function(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){v(t,n,e)}))},y=function(t,e){t.classList.add(e.inactiveButtonClass),t.disabled=!0},b=function(t,e){t.classList.remove(e.inactiveButtonClass),t.disabled=!1},S=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?b(e,n):y(e,n)},E=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.textContent=t?o:n},g=document.querySelector(".profile__edit-button"),L=document.querySelector(".popup_type_edit-profile"),q=document.forms.profile,k=q.elements.name,C=q.elements.about,x=document.querySelector(".profile__name"),U=document.querySelector(".profile__about"),A=document.querySelector(".profile__avatar"),T=document.querySelector(".profile__avatar-edit-button"),D=document.querySelector(".popup_type_edit-avatar"),B=document.forms.avatar,P=B.elements.link,w=document.querySelector(".profile__add-button"),N=document.querySelector(".popup_type_add-card"),O=document.forms.card,j=O.elements.name,I=O.elements.link,J={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__save",inactiveButtonClass:"form__save_disabled",inputErrorClass:"form__input_invalid",errorClass:"form__input-error"};Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{method:"GET",headers:t.headers}).then((function(t){return e(t)})),fetch("".concat(t.baseUrl,"/cards"),{method:"GET",headers:t.headers}).then((function(t){return e(t)}))]).then((function(t){var e=t[0],n=t[1];x.textContent=e.name,U.textContent=e.about,A.src=e.avatar,localStorage.setItem("id",e._id),n.forEach((function(t){var e=p(t);h(e)}))})).catch((function(t){return console.log(t.status)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);S(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?v(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.classList.add("".concat(o.errorClass,"_active")),r.textContent=n}(t,e,e.validationMessage,n)}(t,r,e),S(n,o,e)}))}))}(e,t)}))}(J),g.addEventListener("click",(function(t){k.value=x.textContent,C.value=U.textContent,_(q,J),b(q.querySelector(J.submitButtonSelector),J),c(L)})),T.addEventListener("click",(function(t){B.reset(),_(B,J),c(D)})),w.addEventListener("click",(function(t){O.reset(),_(O,J),c(N)})),q.addEventListener("submit",(function(n){var o;n.preventDefault(),E(!0,n.submitter),(o={name:k.value,about:C.value},fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o.name,about:o.about})}).then((function(t){return e(t)}))).then((function(t){x.textContent=t.name,U.textContent=t.about,a(L)})).catch((function(t){return console.log(t.status)})).finally((function(){return E(!1,n.submitter)}))})),B.addEventListener("submit",(function(n){var o;n.preventDefault(),E(!0,n.submitter),(o={avatar:P.value},fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o.avatar})}).then((function(t){return e(t)}))).then((function(t){A.src=t.avatar,y(n.submitter,J),a(D)})).catch((function(t){return console.log(t.status)})).finally((function(){return E(!1,n.submitter)}))})),O.addEventListener("submit",(function(n){var o;n.preventDefault(),E(!0,n.submitter),(o={name:j.value,link:I.value},fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o.name,link:o.link})}).then((function(t){return e(t)}))).then((function(t){var e=p(t);h(e),y(n.submitter,J),a(N)})).catch((function(t){return console.log(t.status)})).finally((function(){return E(!1,n.submitter)}))}))})();